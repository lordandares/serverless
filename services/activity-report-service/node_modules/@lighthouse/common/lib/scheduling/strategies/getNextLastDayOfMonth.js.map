{"version":3,"sources":["../../../src/scheduling/strategies/getNextLastDayOfMonth.ts"],"names":["moment","Unit","getNextLastDayOfMonth","end","isInitial","options","start","timezone","duration","frequency","durationUnit","unit","durationValue","value","frequencyUnit","frequencyValue","dateCursor","startOfMonth","tz","startOf","Month","valueOf","add","nextOccurrenceEnd","endOf","Day","nextOccurrenceStart","subtract","nextDateCursor"],"mappings":"AAAA,OAAOA,MAAP,MAAmB,iBAAnB;AAEA,SAA4BC,IAA5B,QAAwC,qBAAxC;AAEA;;;;AAGA,OAAO,SAASC,qBAAT,OAMsB;AAAA,MAL3BC,GAK2B,QAL3BA,GAK2B;AAAA,MAJ3BC,SAI2B,QAJ3BA,SAI2B;AAAA,MAH3BC,OAG2B,QAH3BA,OAG2B;AAAA,MAF3BC,KAE2B,QAF3BA,KAE2B;AAAA,MAD3BC,QAC2B,QAD3BA,QAC2B;AAAA,MACnBC,QADmB,GACKH,OADL,CACnBG,QADmB;AAAA,MACTC,SADS,GACKJ,OADL,CACTI,SADS;AAAA,MAEbC,YAFa,GAE0BF,QAF1B,CAEnBG,IAFmB;AAAA,MAEQC,aAFR,GAE0BJ,QAF1B,CAECK,KAFD;AAAA,MAGbC,aAHa,GAG4BL,SAH5B,CAGnBE,IAHmB;AAAA,MAGSI,cAHT,GAG4BN,SAH5B,CAGEI,KAHF;AAK3B,MAAIG,UAAU,GAAGV,KAAjB;;AAEA,SAAOU,UAAU,GAAGb,GAApB,EAAyB;AACvB,QAAMc,YAAY,GAAGb,SAAS,GAC1BJ,MAAM,CACHkB,EADH,CACMF,UADN,EACkBT,QADlB,EAEGY,OAFH,CAEWlB,IAAI,CAACmB,KAFhB,EAGGC,OAHH,EAD0B,GAK1BrB,MAAM,CACHkB,EADH,CACMF,UADN,EACkBT,QADlB,EAEGe,GAFH,CAEOP,cAFP,EAEuBD,aAFvB,EAGGK,OAHH,CAGWlB,IAAI,CAACmB,KAHhB,EAIGC,OAJH,EALJ;AAWA,QAAME,iBAAiB,GAAGvB,MAAM,CAC7BkB,EADuB,CACpBD,YADoB,EACNV,QADM,EAEvBiB,KAFuB,CAEjBvB,IAAI,CAACmB,KAFY,EAGvBE,GAHuB,CAGnB,CAHmB,EAGhBrB,IAAI,CAACwB,GAHW,EAIvBN,OAJuB,CAIflB,IAAI,CAACwB,GAJU,EAKvBJ,OALuB,EAA1B;AAMA,QAAMK,mBAAmB,GAAG1B,MAAM,CAC/BkB,EADyB,CACtBK,iBADsB,EACHhB,QADG,EAEzBoB,QAFyB,CAEhBf,aAFgB,EAEDF,YAFC,EAGzBW,OAHyB,EAA5B;AAKA,QAAIE,iBAAiB,IAAIG,mBAArB,IAA4CH,iBAAiB,GAAGpB,GAApE,EACE;;AAEF,QAAIuB,mBAAmB,IAAIpB,KAA3B,EAAkC;AAChC,aAAO,CAACoB,mBAAD,EAAsBH,iBAAiB,GAAG,CAA1C,CAAP;AACD;;AAED,QAAMK,cAAc,GAAG5B,MAAM,CAC1BkB,EADoB,CACjBD,YADiB,EACHV,QADG,EAEpBe,GAFoB,CAEhB,CAFgB,EAEbrB,IAAI,CAACmB,KAFQ,EAGpBC,OAHoB,EAAvB;AAIAL,IAAAA,UAAU,GAAGY,cAAb;AACD;AACF","sourcesContent":["import moment from 'moment-timezone'\n\nimport { GetNext, Interval, Unit } from '../scheduling.types'\n\n/**\n * Generates next occurrence interval for last day of month strategy\n */\nexport function getNextLastDayOfMonth({\n  end,\n  isInitial,\n  options,\n  start,\n  timezone,\n}: GetNext): Interval | void {\n  const { duration, frequency } = options\n  const { unit: durationUnit, value: durationValue } = duration\n  const { unit: frequencyUnit, value: frequencyValue } = frequency\n\n  let dateCursor = start\n\n  while (dateCursor < end) {\n    const startOfMonth = isInitial\n      ? moment\n          .tz(dateCursor, timezone)\n          .startOf(Unit.Month)\n          .valueOf()\n      : moment\n          .tz(dateCursor, timezone)\n          .add(frequencyValue, frequencyUnit)\n          .startOf(Unit.Month)\n          .valueOf()\n\n    const nextOccurrenceEnd = moment\n      .tz(startOfMonth, timezone)\n      .endOf(Unit.Month)\n      .add(1, Unit.Day)\n      .startOf(Unit.Day)\n      .valueOf()\n    const nextOccurrenceStart = moment\n      .tz(nextOccurrenceEnd, timezone)\n      .subtract(durationValue, durationUnit)\n      .valueOf()\n\n    if (nextOccurrenceEnd <= nextOccurrenceStart || nextOccurrenceEnd > end)\n      return\n\n    if (nextOccurrenceStart >= start) {\n      return [nextOccurrenceStart, nextOccurrenceEnd - 1]\n    }\n\n    const nextDateCursor = moment\n      .tz(startOfMonth, timezone)\n      .add(1, Unit.Month)\n      .valueOf()\n    dateCursor = nextDateCursor\n  }\n}\n"],"file":"getNextLastDayOfMonth.js"}