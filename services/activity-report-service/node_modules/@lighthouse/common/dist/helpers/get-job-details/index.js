"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getJobDetails = getJobDetails;

var _lodash = require("lodash");

var _momentTimezone = _interopRequireDefault(require("moment-timezone"));

var _ = require("../");

function getJobDetails(data) {
  const {
    entity = {},
    timezone,
    users
  } = data;
  const {
    assignees,
    author,
    createdAt,
    description = '-',
    due,
    geometryReverseGeocoded,
    reference = '-',
    status
  } = entity;
  const assigneeNames = (0, _.getAssigneesFullNames)(users, assignees);
  const authorFullName = (0, _.getUserFullName)(users, author);
  const locationText = (0, _.getGeometryGeocodedString)(geometryReverseGeocoded);
  const statusProps = (0, _.getStatusDetails)(status);
  const statusStyle = statusProps.style;
  const statusColor = statusStyle.color;
  const statusText = (0, _lodash.upperCase)(statusProps.text);
  const createdTimezoneDateTime = (0, _.getTimezoneDatetime)({
    timestamp: createdAt,
    timezone
  });
  const dueDateTimezoneDateTime = (0, _.getTimezoneDatetime)({
    timestamp: due,
    timezone
  });

  const timezoneAbbrText = _momentTimezone.default.tz(timezone).format('z');

  return {
    assigneeNames,
    authorFullName,
    createdTimezoneDateTime,
    description,
    dueDateTimezoneDateTime,
    locationText,
    statusStyle,
    statusColor,
    statusText,
    reference,
    timezoneAbbrText
  };
}